---
title: FrontEnd TDD
layout: default
categories: fe-tdd
permalink: /:categories/
---

## FrontEnd TDD

>*TDD是测试驱动开发（Test-Driven Development）的英文简称，是敏捷开发中的一项核心实践和技术，也是一种设计方法论。 TDD的原理是在开发功能代码之前，先编写单元测试用例代码，测试代码确定需要编写什么产品代码。*    

在以敏捷为核心的公司，我们TDD是一大特点，我们也知道TDD的重要性和必要性。TDD的基础是Tasking，Tasking帮助我们更好地理解我们要做的事情，帮助我们拆解独立的开发模块，帮助我们考虑的更加全面。TDD我们一般是测试先行，然后编写实现代码，在已列好的task基础上通过TDD方式进行开发工作，质量以及可维护性将会大大地提高。我们知道，现在应用基本都是前后端分离，我个人参加的有关TDD的工作坊都是基于后端Java代码的实现，这也比较成熟。那么对于前端来讲，是否要TDD，如何做到TDD，这将是一个巨大的挑战，至此我也没有在以前接触过前端TDD，最多也就是后补单元测试。    

机缘巧合的情况下，上周开始我和我的pair在前端开始TDD的工作，至于为什么要这么做，就不做过多的赘述。今天就只总结一下这次的前端TDD实践给我的感受。    

在敏捷的全功能团队中，我们会有故事卡这个概念。在我跟我的pair pick了一张喜欢的故事卡之后，我们开始基于AC进行Tasking。包括toggle、service层的逻辑实现，组件之间交互的实现等等。列完tasking之后，开始写我们的第一个测试用例。我清楚地记得，从早上十点多一点开始写第一个case，那是写的一个组建测试，到差不多十一点终于成功跑了第一个case；然而故事没有结束，当我们写第二个case的时候，不仅第二个case是挂的，第一个case也挂了。修复完这两个case就到了午饭的点了。OK，现在发现问题了么，两个前端的测试用例写了整整一上午，多么大的effort啊。我深深地反思了一下，到底是什么原因导致我们写测试写了这么久，原因如下：    
1. 我个人对jasmine测试框架不熟悉，基本上都是靠猜，哪里应该使用spy，哪里应该stub/callThrough，etc，都是像无头苍蝇乱撞一样的，没有一个测试体系；   2. 前端测试难其实不只是我个人这么认为，事件和异步是导致难的原因，特别是测中间过程的某个步骤，那简直得绞尽脑汁去测；    
3. 对于DOM的测试我们尽量不去测试，但是Angular里面的Directive就是对Dom进行操作，如果测试Directive，那就是在对Dom进行测试，这也是非常不容易的一件事情；    
4. 在我们使用TDD实现了某一个功能之后，发现必须修改某些代码才能完善功能，那么修改代码就会导致去修改测试，是双重的修改；前端不想后端一样，每一个API都是完全独立的，我清晰地知道我需要的输入是什么，输出是什么；而前端不一样，你可能在Tasking的时候并不会考虑到那么细节的东西。        
5. 单元测试跑起来比较麻烦，这次我写单元测试以及跑单元测试，是在相应的it前面加'f'，然后在commit的时候再去掉'f'，会花掉一些时间和耐心，毕竟是重复地加和删；    
6. 外部原因，code coverage达到95%！！！    

针对以上这些痛点，我认为有些是可以改善的：
1. 不熟悉，那么就需要花时间，以及多利用项目的代码去实践，因为测试的方法太多，而不知道用哪一个，那么就多研究看文档，看视频，看资料，去总结；    
2. 事件和异步的测试目测已经改善了不少了，只是能快速准确地识别哪些应该是异步测试，哪些不是，然后如何去测，也是需要花时间去研究的；    
3. Dom的测试同上，没办法，花时间去研究；    
4. 前端测试先行，不太现实，那么我可以做的事情，做完实现，去慢慢补测试，但是在实现的同时要考虑到测试怎么写；    
5. Intellij有一个karma的插件可以帮助我们只跑一个测试，不需要每次都加前缀'f'，大大地解放了生产力；    
6. 我们自己应该对自己有严格的要求（都是扯淡，只有出了问题才说我们对自己要求不严格，实际上前端写那么多测试，修改又那么频繁，维护测试的成本也包括其中，而且估点又没考虑到测试），这条我只能说，以后做项目，一开始就跟客户承诺好，或是讨论好我们自己的测试的策略和标准。    

虽然前端TDD很痛苦，也超过了这个故事卡的预计时间，但是我还是感觉非常地有成就感的，对于将来代码的维护也好，对于对测试的更多地理解也好，都是巨大的帮助，加油，后面还有很多事情哟！    